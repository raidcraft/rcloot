<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<migration xmlns="http://ebean-orm.github.io/xml/ns/dbmigration">
    <changeSet type="apply">
        <createTable name="rc_loot_objects" pkName="pk_rc_loot_objects">
            <column name="id" type="integer" primaryKey="true"/>
            <column name="loot_table_id" type="integer" notnull="true" references="rc_loot_tables.id"
                    foreignKeyName="fk_rc_loot_objects_loot_table_id"
                    foreignKeyIndex="ix_rc_loot_objects_loot_table_id"/>
            <column name="world" type="varchar" notnull="true"/>
            <column name="x" type="integer" notnull="true"/>
            <column name="y" type="integer" notnull="true"/>
            <column name="z" type="integer" notnull="true"/>
            <column name="enabled" type="boolean" defaultValue="false" notnull="true"/>
            <column name="cooldown" type="integer" notnull="true"/>
            <column name="infinite" type="boolean" defaultValue="false" notnull="true"/>
            <column name="public_loot_object" type="boolean" defaultValue="false" notnull="true"/>
        </createTable>
        <createTable name="rc_loot_players" pkName="pk_rc_loot_players">
            <column name="id" type="integer" primaryKey="true"/>
            <column name="player_id" type="uuid" notnull="true"/>
            <column name="loot_object_id" type="integer" notnull="true" references="rc_loot_objects.id"
                    foreignKeyName="fk_rc_loot_players_loot_object_id"
                    foreignKeyIndex="ix_rc_loot_players_loot_object_id"/>
            <column name="created" type="timestamp" notnull="true"/>
        </createTable>
        <createTable name="rc_loot_tables" pkName="pk_rc_loot_tables">
            <column name="id" type="integer" primaryKey="true"/>
            <column name="min_loot" type="integer" notnull="true"/>
            <column name="max_loot" type="integer" notnull="true"/>
        </createTable>
        <createTable name="rc_loot_table_aliases" pkName="pk_rc_loot_table_aliases">
            <column name="id" type="integer" primaryKey="true"/>
            <column name="loot_table_id" type="integer" uniqueOneToOne="uq_rc_loot_table_aliases_loot_table_id"
                    references="rc_loot_tables.id" foreignKeyName="fk_rc_loot_table_aliases_loot_table_id"/>
            <column name="table_alias" type="varchar" notnull="true" unique="uq_rc_loot_table_aliases_table_alias"/>
        </createTable>
        <createTable name="rc_loot_table_entries" pkName="pk_rc_loot_table_entries">
            <column name="id" type="integer" primaryKey="true"/>
            <column name="loot_table_id" type="integer" notnull="true" references="rc_loot_tables.id"
                    foreignKeyName="fk_rc_loot_table_entries_loot_table_id"
                    foreignKeyIndex="ix_rc_loot_table_entries_loot_table_id"/>
            <column name="item" type="varchar" notnull="true"/>
            <column name="amount" type="integer" notnull="true"/>
            <column name="chance" type="double" notnull="true"/>
        </createTable>
        <createTable name="rc_loot_table_qualities" pkName="pk_rc_loot_table_qualities">
            <column name="id" type="integer" primaryKey="true"/>
            <column name="loot_table_id" type="integer" notnull="true" references="rc_loot_tables.id"
                    foreignKeyName="fk_rc_loot_table_qualities_loot_table_id"
                    foreignKeyIndex="ix_rc_loot_table_qualities_loot_table_id"/>
            <column name="quality" type="varchar(9)" notnull="true"
                    checkConstraint="check ( quality in ('POOR','COMMON','UNCOMMON','RARE','EPIC','LEGENDARY'))"
                    checkConstraintName="ck_rc_loot_table_qualities_quality"/>
            <column name="min_amount" type="integer" notnull="true"/>
            <column name="max_amount" type="integer" notnull="true"/>
            <column name="chance" type="double" notnull="true"/>
        </createTable>
    </changeSet>
</migration>